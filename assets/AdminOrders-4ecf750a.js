import{D as C,P as D,M as k}from"./DeleteModal-d6c32b83.js";import{_ as v,o as l,c as o,a as t,t as s,g as f,F as u,f as y,h as O,k as M,r as m,b as p,n as P}from"./index-583170de.js";const L={props:["tempOrder"],data(){return{order:{},isPaid:!1}},emits:["update-paid"]},Y={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog modal-xl",role:"document"},V={class:"modal-content border-0"},E=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"orderModal"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},N={class:"row"},B={class:"col-md-4"},q=t("h3",null,"用戶資料",-1),z={class:"table"},A={key:0},F=t("th",{style:{width:"100px"}},"姓名",-1),I=t("th",null,"Email",-1),j=t("th",null,"電話",-1),S=t("th",null,"地址",-1),T=t("th",null,"留言",-1),G={class:"col-md-8"},J=t("h3",null,"訂單細節",-1),K={class:"table"},Q=t("th",{style:{width:"100px"}},"訂單編號",-1),R=t("th",null,"下單時間",-1),W=t("th",null,"付款時間",-1),X={key:0},Z={key:1},tt=t("th",null,"付款狀態",-1),et={key:0,class:"text-success"},st={key:1,class:"text-muted"},lt=t("th",null,"總金額",-1),ot=t("h3",null,"選購商品",-1),nt={class:"table"},dt=t("thead",null,[t("tr")],-1),at={class:"text-end"},it={class:"d-flex justify-content-end"},rt={class:"form-check"},ct={class:"form-check-label",for:"flexCheckDefault"},ht={key:0},ut={key:1},_t={class:"modal-footer"},mt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function pt(n,d,e,_,i,h){return l(),o("div",Y,[t("div",U,[t("div",V,[E,t("div",H,[t("div",N,[t("div",B,[q,t("table",z,[e.tempOrder.user?(l(),o("tbody",A,[t("tr",null,[F,t("td",null,s(e.tempOrder.user.name),1)]),t("tr",null,[I,t("td",null,s(e.tempOrder.user.email),1)]),t("tr",null,[j,t("td",null,s(e.tempOrder.user.tel),1)]),t("tr",null,[S,t("td",null,s(e.tempOrder.user.address),1)]),t("tr",null,[T,t("td",null,s(e.tempOrder.message),1)])])):f("",!0)])]),t("div",G,[J,t("table",K,[t("tbody",null,[t("tr",null,[Q,t("td",null,s(e.tempOrder.id),1)]),t("tr",null,[R,t("td",null,s(n.$moment(new Date(e.tempOrder.create_at*1e3)).format("YYYY-MM-DD HH:mm")),1)]),t("tr",null,[W,t("td",null,[e.tempOrder.paid_date?(l(),o("span",X,s(n.$$moment(new Date(e.tempOrder.paid_date*1e3))),1)):(l(),o("span",Z,"時間不正確"))])]),t("tr",null,[tt,t("td",null,[i.order.is_paid?(l(),o("strong",et,"已付款")):(l(),o("span",st,"尚未付款"))])]),t("tr",null,[lt,t("td",null,s(e.tempOrder.total),1)])])]),ot,t("table",nt,[dt,t("tbody",null,[(l(!0),o(u,null,y(i.order.products,r=>(l(),o("tr",{key:r.id},[t("th",null,s(r.product.title),1),t("td",null,s(r.qty)+" / "+s(r.product.unit),1),t("td",at,s(r.final_total),1)]))),128))])]),t("div",it,[t("div",rt,[O(t("input",{type:"checkbox",class:"form-check-input",value:"",id:"flexCheckDefault","onUpdate:modelValue":d[0]||(d[0]=r=>i.order.is_paid=r)},null,512),[[M,i.order.is_paid]]),t("label",ct,[i.order.is_paid?(l(),o("span",ht,"已付款")):(l(),o("span",ut,"未付款"))])])])])])]),t("div",_t,[mt,t("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=r=>n.$emit("update-paid",e.tempOrder))}," 修改付款狀態")])])])],512)}const bt=v(L,[["render",pt]]),b="https://vue3-course-api.hexschool.io",g="asher_api",gt={data(){return{orders:[],isNew:!1,pagination:{},tempOrder:{},page:1}},components:{DeleteModal:C,Pagination:D,OrderModal:bt},methods:{getOrdersList(n=1){this.page=n;const d=`${b}/v2/api/${g}/admin/orders/?page=${n}`;this.$http.get(d,this.tempProduct).then(e=>{this.orders=e.data.orders,this.pagination=e.data.pagination}).catch(e=>{console.log(e)})},openModal(n,d){n==="view"?(this.orderModal.show(),this.tempOrder={...d}):n==="delete"&&(this.deleteModal.show(),this.tempOrder={...d})},updatePaid(n){this.isLoading=!0;const d=`${b}/v2/api/${g}/admin/order/${n.id}`,e={is_paid:n.is_paid};this.$http.put(d,{data:e}).then(_=>{this.orderModal.hide(),this.getOrdersList(this.page)}).catch(_=>{console.log(_)})},deleteOrder(){const n=`${b}/v2/api/${g}/admin/order/${this.tempOrder.id}`;this.$http.delete(n).then(d=>{alert(d.data.message),this.deleteModal.hide(),this.getOrdersList(this.page)}).catch(d=>{console.log(d)})}},mounted(){const n=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=n,this.getOrdersList(),this.orderModal=new k("#orderModal"),this.deleteModal=new k("#delProductModal")}},ft={class:"container"},yt={class:"table mt-4"},kt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),vt=["textContent"],Ot={class:"list-unstyled"},Mt={class:"text-right"},xt={class:"form-check form-switch"},$t=["id","onUpdate:modelValue","onChange"],wt=["for"],Ct={key:0},Dt={key:1,class:"text-muted"},Pt={class:"btn-group"},Lt=["onClick"],Yt=["onClick"];function Ut(n,d,e,_,i,h){const r=m("order-modal"),x=m("delete-modal"),$=m("pagination");return l(),o(u,null,[t("div",ft,[t("table",yt,[kt,t("tbody",null,[(l(!0),o(u,null,y(i.orders,a=>(l(),o(u,{key:a.id},[i.orders.length?(l(),o("tr",{key:0,class:P({"text-secondary":!a.is_paid})},[t("td",null,s(n.$moment(new Date(a.create_at*1e3)).format("YYYY-MM-DD HH:mm")),1),t("td",null,[a.user?(l(),o("span",{key:0,textContent:s(a.user.email)},null,8,vt)):f("",!0)]),t("td",null,[t("ul",Ot,[(l(!0),o(u,null,y(a.products,(c,w)=>(l(),o("li",{key:w},s(c.product.title)+" 數量："+s(c.qty)+" "+s(c.product.unit),1))),128))])]),t("td",Mt,s(a.total),1),t("td",null,[t("div",xt,[O(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:a.id,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>h.updatePaid(a)},null,40,$t),[[M,a.is_paid]]),t("label",{class:"form-check-label",for:a.id},[a.is_paid?(l(),o("span",Ct,"已付款")):(l(),o("span",Dt,"未付款"))],8,wt)])]),t("td",null,[t("div",Pt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>h.openModal("view",a)}," 檢視 ",8,Lt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>h.openModal("delete",a)}," 刪除 ",8,Yt)])])],2)):f("",!0)],64))),128))])])]),p(r,{"temp-order":i.tempOrder,onUpdatePaid:h.updatePaid,ref:"orderModal"},null,8,["temp-order","onUpdatePaid"]),p(x,{item:i.tempOrder,onDelItem:h.deleteOrder},null,8,["item","onDelItem"]),p($,{pages:i.pagination,onEmitPages:h.getOrdersList},null,8,["pages","onEmitPages"])],64)}const Ht=v(gt,[["render",Ut]]);export{Ht as default};
